<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>REST API Test Page</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 2rem; line-height: 1.4; }
    .wrap { max-width: 900px; margin: 0 auto; }
    h1 { font-size: 1.5rem; margin: 0 0 1rem; }
    label { display: block; font-weight: 600; margin: 1rem 0 .5rem; }
    input[type="text"] { width: 100%; padding: .6rem .7rem; border-radius: .5rem; border: 1px solid #ccc; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .row { display: flex; gap: .5rem; flex-wrap: wrap; align-items: center; margin-top: .75rem; }
    button { padding: .55rem .9rem; border: 1px solid #8884; border-radius: .5rem; background: #eee; cursor: pointer; }
    button:hover { filter: brightness(0.97); }
    .meta { font-size: .9rem; opacity: .8; margin-top: .5rem; }
    .error { color: #b00020; font-weight: 600; }
    pre { background: #0000000c; border: 1px solid #0000001a; padding: 1rem; border-radius: .5rem; overflow: auto; }
    .small { font-size: .85rem; }
    .pill { display: inline-block; padding: .15rem .45rem; border: 1px solid #8884; border-radius: 999px; font-size: .8rem; margin-left: .4rem; }
    table { width: 100%; border-collapse: collapse; margin-top: .5rem; }
    thead th { text-align: left; background: #0000000c; }
    th, td { border: 1px solid #0000001a; padding: .5rem .6rem; vertical-align: top; }
    tbody tr:nth-child(even) { background: #00000006; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>REST API Test Page <span class="pill" id="method-pill">GET</span></h1>
    <p class="small">Auto-fetches a public demo API and displays the result in a simple table.</p>

    <label for="endpoint">Endpoint URL</label>
    <input id="endpoint" type="text" value="https://api.restful-api.dev/objects?id=3&id=5&id=10" />

    <div class="row">
      <button id="fetchBtn" title="Fetch now">Fetch</button>
      <button id="resetBtn" title="Reset to example URL">Reset</button>
      <span class="meta" id="meta"></span>
    </div>

    <div id="error" class="error" role="alert" style="display:none"></div>

    <h2 style="margin-top:1.25rem; font-size:1.1rem;">Response</h2>
    <div id="tableRegion" aria-live="polite">
      <div class="small" id="placeholder">Fetching data…</div>
      <div style="overflow:auto;">
        <table id="resultTable" style="display:none;">
          <thead>
            <tr id="theadRow"></tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <pre id="rawOutput" style="display:none;"></pre>
    </div>

    <details style="margin-top:1rem;">
      <summary>What is happening?</summary>
      <ul>
        <li>This page makes a simple HTTP GET request using the Fetch API.</li>
        <li>If the response is JSON, it is pretty-printed. Otherwise, raw text is shown.</li>
        <li>It shows status, timing, and content type for quick debugging.</li>
      </ul>
    </details>
  </div>

  <script>
    (function () {
      const endpointEl = document.getElementById('endpoint');
  const tableEl = document.getElementById('resultTable');
  const theadRowEl = document.getElementById('theadRow');
  const tbodyEl = document.getElementById('tbody');
  const rawOutputEl = document.getElementById('rawOutput');
  const placeholderEl = document.getElementById('placeholder');
      const errorEl = document.getElementById('error');
      const metaEl = document.getElementById('meta');
      const fetchBtn = document.getElementById('fetchBtn');
      const resetBtn = document.getElementById('resetBtn');
      const methodPill = document.getElementById('method-pill');

      const DEFAULT_URL = 'https://api.restful-api.dev/objects?id=3&id=5&id=10';

      function setLoading(isLoading) {
        fetchBtn.disabled = isLoading;
        fetchBtn.textContent = isLoading ? 'Fetching…' : 'Fetch';
      }

      function clearResults() {
        // Hide table and raw output, show placeholder
        tableEl.style.display = 'none';
        rawOutputEl.style.display = 'none';
        placeholderEl.style.display = '';
        placeholderEl.textContent = 'Fetching data…';
        theadRowEl.innerHTML = '';
        tbodyEl.innerHTML = '';
      }

      function reset() {
        endpointEl.value = DEFAULT_URL;
        clearResults();
        errorEl.style.display = 'none';
        errorEl.textContent = '';
        metaEl.textContent = '';
        methodPill.textContent = 'GET';
      }

      function toArray(maybeArray) {
        if (Array.isArray(maybeArray)) return maybeArray;
        if (maybeArray && typeof maybeArray === 'object') return [maybeArray];
        return [];
      }

      function stringifyCell(value) {
        if (value == null) return '';
        if (typeof value === 'object') return JSON.stringify(value);
        return String(value);
      }

      function renderTable(data) {
        const rows = toArray(data);
        if (!rows.length) {
          clearResults();
          placeholderEl.textContent = '(no results)';
          return;
        }

        // Sort rows by the "name" column (case-insensitive, numeric-aware). Tie-breaker: id.
        rows.sort((a, b) => {
          const an = (a && typeof a === 'object' && a.name != null) ? String(a.name) : '';
          const bn = (b && typeof b === 'object' && b.name != null) ? String(b.name) : '';
          const cmp = an.localeCompare(bn, undefined, { numeric: true, sensitivity: 'base' });
          if (cmp !== 0) return cmp;
          const aid = (a && a.id != null) ? String(a.id) : '';
          const bid = (b && b.id != null) ? String(b.id) : '';
          return aid.localeCompare(bid, undefined, { numeric: true, sensitivity: 'base' });
        });

        // Header: only show the "name" column
        theadRowEl.innerHTML = '';
        {
          const th = document.createElement('th');
          th.textContent = 'name';
          theadRowEl.appendChild(th);
        }

        // Body: only show name values
        tbodyEl.innerHTML = '';
        rows.forEach(obj => {
          const tr = document.createElement('tr');
          const td = document.createElement('td');
          td.textContent = stringifyCell(obj && obj.name);
          tr.appendChild(td);
          tbodyEl.appendChild(tr);
        });

        // Show table
        placeholderEl.style.display = 'none';
        rawOutputEl.style.display = 'none';
        tableEl.style.display = '';
      }

      async function doFetch() {
        const url = endpointEl.value.trim();
        if (!url) return;

        errorEl.style.display = 'none';
        errorEl.textContent = '';
        clearResults();
        metaEl.textContent = '';
        methodPill.textContent = 'GET';

        setLoading(true);
        const t0 = performance.now();
        try {
          const res = await fetch(url, {
            method: 'GET',
            headers: { 'Accept': 'application/json, text/plain;q=0.9, */*;q=0.8' },
          });
          const t1 = performance.now();

          const ct = res.headers.get('content-type') || '';
          metaEl.textContent = `Status: ${res.status} ${res.statusText} • Time: ${(t1 - t0).toFixed(1)} ms • Content-Type: ${ct}`;

          let bodyText;
          try {
            if (ct.includes('application/json')) {
              const json = await res.json();
              renderTable(json);
              bodyText = undefined;
            } else {
              bodyText = await res.text();
            }
          } catch (parseErr) {
            bodyText = `[Parse error] ${String(parseErr)}`;
          }

          if (bodyText !== undefined) {
            placeholderEl.style.display = 'none';
            tableEl.style.display = 'none';
            rawOutputEl.style.display = '';
            rawOutputEl.textContent = bodyText || '(empty response)';
          }

          if (!res.ok) {
            errorEl.style.display = '';
            errorEl.textContent = `Request completed with HTTP ${res.status}.`;
          }
        } catch (err) {
          const t1 = performance.now();
          metaEl.textContent = `Failed • Time: ${(t1 - t0).toFixed(1)} ms`;
          errorEl.style.display = '';
          errorEl.textContent = `Network or CORS error: ${err && err.message ? err.message : String(err)}`;
          clearResults();
          placeholderEl.textContent = 'No data.';
        } finally {
          setLoading(false);
        }
      }

      fetchBtn.addEventListener('click', doFetch);
      resetBtn.addEventListener('click', reset);

      // Auto-fetch on load
      doFetch();
    })();
  </script>
</body>
</html>
